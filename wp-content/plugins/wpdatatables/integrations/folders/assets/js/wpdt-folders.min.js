!function(e){e(function(){let t={selectedNodeId:null,instance:e("#wpdt-folder-tree"),isContextMenu:!1,type:e(".wpdt-folders-card").data("type"),init:function(){t.instance.jstree({plugins:["search","unique","contextmenu"],core:{cache:!1,check_callback:!0},contextmenu:{show_at_node:!1,items:{addSubNode:{label:"New Sub Folder",icon:"wpdt-icon-plus-wa",separator_after:!0,action:function(d){t.isContextMenu=!0,e("#wpdt-create-folder-btn").trigger("click")}},rename:{label:"Rename",icon:"wpdt-icon-edit",action:function(d){t.isContextMenu=!0,e("#wpdt-edit-folder-btn").trigger("click")}},remove:{label:"Remove",icon:"wpdt-icon-trash",action:function(d){t.isContextMenu=!0,e("#wpdt-delete-folder-btn").trigger("click")}}}},search:{show_only_matches:!0,case_sensitive:!1,fuzzy:!1}}).bind("ready.jstree",function(d,r){t.isContextMenu=!1;var a=wpdatatables_folders_data.settings;if(wpdatatables_folders_data.folders.length&&(t.refreshFolders(wpdatatables_folders_data.folders),t.resetFoldersCount()),t.instance.removeClass("hidden"),e(".wpdt-c .sort-menu a").filter(function(){return e(this).data("value")===a[t.type].sort}).closest("li").addClass("active"),e(".wpdt-c .columns-menu a").filter(function(){return a[t.type].columnsToHide.includes(e(this).data("value"))}).closest("li").removeClass("active"),a[t.type].columnsToHide.length){let s="report"===t.type?e("#reportbuilder_browse_form"):e("#wdt-datatables-browse-table");for(let o=0;o<a[t.type].columnsToHide.length;o++)s.find("table .column-"+a[t.type].columnsToHide[o]).addClass("hidden")}a[t.type].collapsed&&e(".close-folders-card").click(),t.applyDragAndDrop()}).bind("refresh.jstree",function(d,r){e(".wpdt-folders-sum li a").removeClass("jstree-clicked"),t.resetFoldersCount(),t.applyDragAndDrop();let a=new URLSearchParams(window.location.search),s=parseInt(a.get("folderID"));if(wpdatatables_folders_data.settings[t.type].showChildren?(e("#wpdt-all-open-close-folder-btn").addClass("show-all"),t.instance.jstree(!0).open_all()):(e("#wpdt-all-open-close-folder-btn").removeClass("show-all"),t.instance.jstree(!0).close_all()),isNaN(s))e("#wpdt-all-folder_anchor").addClass("jstree-clicked");else{if(0===s){e("#wpdt-unassigned-folder_anchor").addClass("jstree-clicked");return}if(-1===s){e("#wpdt-all-folder_anchor").addClass("jstree-clicked");return}let o=t.instance.jstree(!0),n=o.get_node(s);o.select_node(n)}}).bind("before_open.jstree",function(e,d){t.resetFoldersCount()}).bind("after_open.jstree",function(e,d){t.applyDragAndDrop(),t.resetFoldersCount()}).bind("open_all.jstree",function(e,d){t.applyDragAndDrop(),t.resetFoldersCount()}).bind("create_node.jstree",function(e,d){t.applyDragAndDrop(),t.resetFoldersCount()}).bind("delete_node.jstree",function(e,d){t.applyDragAndDrop()}).bind("rename_node.jstree",function(e,d){t.resetFoldersCount(),t.applyDragAndDrop()}).bind("close_all.jstree",function(e,d){t.applyDragAndDrop(),t.resetFoldersCount()}).bind("after_close.jstree",function(e,d){t.applyDragAndDrop(),t.resetFoldersCount()}).bind("select_node.jstree",function(){t.handleSelectNode()}).on("search.jstree",function(e,d){0===d.nodes.length&&t.instance.jstree(!0).hide_all()}),e("#wpdt-inline-logo").addClass("hidden"),e(".wpdt-folders-sum li a").on("click",function(d){e(".wpdt-folders-sum li a").removeClass("jstree-clicked");let r=t.instance.jstree("get_selected",!0)[0];r&&t.instance.jstree(!0).deselect_node(r),e("#wpdt-edit-folder-btn").addClass("disabled"),e("#wpdt-delete-folder-btn").addClass("disabled"),e(this).addClass("jstree-clicked")}),e(".close-folders-card").on("click",function(d){var r=!1;e(".card-wrapper").hasClass("hidden")?(e(".card-header.wdt-admin-card-header").css("cssText","padding: 35px 0 14px 0 !important;"),e("#wpdt-inline-logo").addClass("hidden"),e(".wpdt-folders-card").removeClass("collapsed").css("cssText","min-width: 410px !important;padding-right:10px !important;transition: all .15s linear;-webkit-transition: all .15s linear;"),e(".wpdt-icon-angle-left").removeClass("hidden"),e(".wpdt-icon-angle-right").addClass("hidden"),setTimeout(function(){e(".card-wrapper").removeClass("hidden")},500)):(r=!0,e(".card-wrapper").addClass("hidden"),e("#wpdt-inline-logo").removeClass("hidden"),e(".wpdt-folders-card").addClass("collapsed").css("cssText","min-width: 0px !important;padding-right:0 !important;transition: all .15s linear;-webkit-transition: all .15s linear;"),e(".wpdt-icon-angle-left").addClass("hidden"),e(".wpdt-icon-angle-right").removeClass("hidden"),e(".card-header.wdt-admin-card-header").css("cssText","padding: 0 0 14px 0 !important;")),e.ajax({url:ajaxurl,type:"POST",data:{collapsed:r,action:"wpdatatables_collapse_folders",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var r=e.parseJSON(d);if(r.error){wdtNotify("Error!",r.error,"danger");return}r.success&&(r.collapsed?wdtNotify("Success!","Collapse folders option is saved!","success"):wdtNotify("Success!","Show folders option is saved!","success"),wpdatatables_folders_data.settings[t.type].collapsed=r.collapsed)},error:function(e){wdtNotify("Error!","Unable to sort a folder. Please try again.","danger")}})}),e(document).on("click",".wpdt-reassign-folder",function(d){d.stopImmediatePropagation();var r=e(this).data("folder-id"),a=e(this).data(t.type+"-id"),s=e(this);t.handleFoldersModal("wpdt-remove-folder-tag"),e("#wpdt-remove-folder-modal").on("click",function(d){d.preventDefault(),d.stopPropagation(),t.handleRemoveFolderTag(r,a,s),e(this).off("click")})}),e(document).on("click","a.jstree-anchor",function(d){var r=e(this).closest("li.jstree-node").attr("id");let a=window.location.href;a=a.replace("#/","");var s=new URLSearchParams(a.split("?")[1]),o={};s.forEach(function(e,t){o[t]=e}),void 0!==o.folderID&&(o.folderID=r),e.ajax({url:ajaxurl,type:"POST",data:{params:o,folderID:r,action:"wpdatatables_filter_browse_lists_table",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var r=e.parseJSON(d);if(r.error){wdtNotify("Error!",r.error,"danger");return}if(r.success){let a=wpdatatables_folders_data.settings[t.type],s="report"===t.type?e("#reportbuilder_browse_form"):e("#wdt-datatables-browse-table");if(history.pushState(null,null,r.url),s.empty().html(r.data),a.columnsToHide.length)for(let o=0;o<a.columnsToHide.length;o++)s.find("table .column-"+a.columnsToHide[o]).addClass("hidden");t.applyDragAndDrop()}},error:function(e){wdtNotify("Error!","Unable to find a folder. Please try again.","danger")}})}),e(document).on("click","#wpdt-create-folder-btn,#wpdt-edit-folder-btn,#wpdt-delete-folder-btn",function(e){t.handleFoldersModal(this.id)}),e(document).on("click","#wpdt-folder-tree span.wpdt-folder-inline-edit",function(d){d.stopImmediatePropagation(),d.stopPropagation(),t.isContextMenu=!0;var r=e(this).offset().left+40,a=e(this).offset().top;let s=t.instance.jstree("get_selected",!0)[0];t.instance.jstree(!0).show_contextmenu(e("#"+s.id),r,a)}),e(document).on("click","#wpdt-delete-folder-modal",function(e){t.handleDeleteFolder()}),e("#wpdt-all-open-close-folder-btn").on("click",function(){let d=!1;e(this).toggleClass("show-all"),e(this).hasClass("show-all")&&(d=!0),e.ajax({url:ajaxurl,type:"POST",data:{showChildren:d,action:"wpdatatables_show_children_folders",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var r=e.parseJSON(d);if(r.error){wdtNotify("Error!",r.error,"danger");return}r.success&&(r.showChildren?(e("#wpdt-all-open-close-folder-btn").addClass("show-all"),t.instance.jstree(!0).open_all(),wdtNotify("Success!","Show all folders option is saved!","success")):(e("#wpdt-all-open-close-folder-btn").removeClass("show-all"),t.instance.jstree(!0).close_all(),wdtNotify("Success!","Close all folders option is saved!","success")),wpdatatables_folders_data.settings[t.type].showChildren=r.showChildren)},error:function(e){wdtNotify("Error!","Unable to sort a folder. Please try again.","danger")}})}),e("#wpdt-sort-folder-btn").on("click",function(){e(".sort-menu").toggleClass("hidden")}),e("#wpdt-show-columns-btn").on("click",function(){e(".columns-menu").toggleClass("hidden")}),e(".sort-menu a").on("click",function(d){d.preventDefault();var r=e(this).data("value");e(".sort-menu li").removeClass("active"),e(this).closest("li").addClass("active"),e.ajax({url:ajaxurl,type:"POST",data:{sortOrder:r,action:"wpdatatables_sort_order_folders",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var r=e.parseJSON(d);if(r.error){wdtNotify("Error!",r.error,"danger");return}r.success&&(t.refreshFolders(r.data),t.resetFoldersCount(),t.applyDragAndDrop(),wdtNotify("Success!","Chosen sort order is saved","success"))},error:function(e){wdtNotify("Error!","Unable to sort a folder. Please try again.","danger")}})}),e(".columns-menu a").on("click",function(d){d.preventDefault();let r=[],a=e(this).data("value"),s="report"===t.type?e("#reportbuilder_browse_form"):e("#wdt-datatables-browse-table");e(this).closest("li").toggleClass("active"),e(this).closest("li").hasClass("active")?s.find("table .column-"+a).removeClass("hidden"):s.find("table .column-"+a).addClass("hidden"),e(".columns-menu li:not(.active) a").each(function(){r.push(e(this).data("value"))}),e.ajax({url:ajaxurl,type:"POST",data:{columnsToHide:r,action:"wpdatatables_save_browse_columns",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var r=e.parseJSON(d);if(r.error){wdtNotify("Error!",r.error,"danger");return}r.success&&(wpdatatables_folders_data.settings[t.type].columnsToHide=r.columnsToHide,wdtNotify("Success!","Column visibility is changed!","success"))},error:function(e){wdtNotify("Error!","Unable to hide a column. Please try again.","danger")}})}),e(document).on("click",function(t){e(t.target).is("#wpdt-sort-folder-btn, .sort-menu, .sort-menu *")||e(".sort-menu").addClass("hidden")}),e(document).on("click",function(t){e(t.target).is("#wpdt-show-columns-btn, .columns-menu, .columns-menu *")||e(".columns-menu").addClass("hidden")}),e("#wpdt-save-folder-modal").on("click",function(e){e.stopImmediatePropagation(),t.handleSaveFolder()}),e("#wpdt-folder-name").on("focus",function(){e("#wpdt-folder-unique-error, #wpdt-folder-empty-error").addClass("hidden")}),e("#wpdt-folder-modal").on("hidden.bs.modal",function(t){e("#wpdt-folder-unique-error, #wpdt-folder-empty-error").addClass("hidden")}).on("shown.bs.modal",function(){e(this).find("#wpdt-folder-name").focus()}),e(document).on("keyup","#wpdt-folder-modal",function(t){t.preventDefault(),t.stopImmediatePropagation(),27==t.which&&e("#wpdt-folder-modal").modal("hide")}).on("keyup change blur","#wpdt-folder-search",function(){t.folderSearch()}),e("#wpdt-folder-tree-wrapper").height(725).overlayScrollbars({className:"os-theme-dark",resize:"none",scrollbars:{autoHide:"never"}})},applyDragAndDrop:function(){e(".wpdt-move-"+t.type+":not(.ui-draggable)").draggable({revert:"invalid",containment:"document",cursor:"move",cursorAt:{left:0,top:0},helper:function(d,r){e(".selected-"+t.type+"s").remove();let a=e("#wpdt-the-list th input:checked").length;return a>0?(a=0==a||1==a?"1 "+t.type:a+" "+t.type+"s ",e("<div class='selected-"+t.type+"s'><span class='total-count'>"+a+" selected</span></div>")):e(this).clone(!0)},start:function(t,d){e(this).closest("td").addClass("wpdt-draggable"),e(".wpdt-root-folder").css("opacity",.5),e(".wpdt-unassigned-folder").css("opacity",.5)},stop:function(t,d){e(this).closest("td").removeClass("wpdt-draggable"),e(".wpdt-root-folder").css("opacity",1),e(".wpdt-unassigned-folder").css("opacity",1)}}),e(".wpdt-move-multiple-"+t.type+"s:not(.ui-draggable)").draggable({revert:"invalid",containment:"document",helper:function(d,r){e(".selected-"+t.type+"s").remove();let a=e("#wpdt-the-list th input:checked").length;return a>0?(a=0==a||1==a?"1 "+t.type:a+" "+t.type+"s ",e("<div class='selected-"+t.type+"s'><span class='total-count'>"+a+" selected</span></div>")):e("<div class='selected-"+t.type+"s'><span class='total--count'>Select "+t.type+" to move</span></div>")},start:function(t,d){e("body").addClass("no-hover-css"),e(".wpdt-root-folder").css("opacity",.5),e(".wpdt-unassigned-folder").css("opacity",.5)},stop:function(d,r){e(".selected-"+t.type+"s").remove(),e("body").removeClass("no-hover-css"),e(".wpdt-root-folder").css("opacity",1),e(".wpdt-unassigned-folder").css("opacity",1)},cursor:"move",cursorAt:{left:0,top:0}}),e("#wpdt-folder-tree .jstree-anchor:not(.ui-droppable)").droppable({accept:".wpdt-move-"+t.type+", .wpdt-move-multiple-"+t.type+"s",hoverClass:"wpdt-drop-hover",tolerance:"pointer",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(d,r){var a=e(this).closest("li.jstree-node").attr("id"),s=t.instance.jstree(!0).get_node(a).text,o=new URLSearchParams(window.location.search),n=parseInt(o.get("folderID")),l="report"===t.type?e("#reportbuilder_browse_form"):e("#wdt-datatables-browse-table");if(r.draggable.hasClass("wpdt-move-multiple-"+t.type+"s")){if(l.find(".wp-list-table input:checked").length){let i=[];l.find(".wp-list-table input:checked").each(function(){isNaN(parseInt(e(this).val()))||i.push(parseInt(e(this).val()))}),e.ajax({url:ajaxurl,type:"POST",data:{item_ids:i,item_count:i.length,folder_name:s,folder_id:a,action:"wpdatatables_assign_items_in_folder",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var r=e.parseJSON(d);if(r.error){wdtNotify("Error!",r.error,"danger");return}if(r.success){if(e(".jstree-node[id='"+r.data.folder_id+"'] > a.jstree-anchor .wpdt-folder-count").html(r.data.item_count),r.data.item_ids.length){for(let a=0;a<r.data.item_ids.length;a++)isNaN(n)||0!==n?e("#wpdt-the-list td.column-id").filter(function(){return parseInt(this.innerText)===r.data.item_ids[a]}).closest("tr").find(".column-folders").append('<span class="wpdt-folder-tag"><a class="wpdt-folder-tag-link wpdt-node-class-id-'+r.data.folder_id+'" href="admin.php?page='+r.data.item_page+"&folderID="+r.data.folder_id+'">'+r.data.folder_name+'</a><span class="wpdt-reassign-folder" data-folder-id="'+r.data.folder_id+'"  data-item-id="'+r.data.item_ids[a]+'"></span></span>'):e("#wpdt-the-list td.column-id").filter(function(){return parseInt(this.innerText)===r.data.item_ids[a]}).closest("tr").remove();l.find(".wp-list-table input:checked").length&&l.find(".wp-list-table input:checked").click(),e("#wpdt-unassigned-folder_anchor .wpdt-count").html(r.data.unassigned),wdtNotify("Success!",r.data.type_caps+"s are assigned to the folder.","success")}else wdtNotify("Error!",r.data.type_caps+" ids are empty.","danger")}},error:function(e){wdtNotify("Error!","Unable to assign a folder. Please try again.","danger")}})}}else if(r.draggable.hasClass("wpdt-move-"+t.type)){if(l.find(".wp-list-table input:checked").length){let c=[];l.find(".wp-list-table input:checked").each(function(){isNaN(parseInt(e(this).val()))||c.push(parseInt(e(this).val()))}),e.ajax({url:ajaxurl,type:"POST",data:{item_ids:c,item_count:c.length,folder_name:s,folder_id:a,action:"wpdatatables_assign_items_in_folder",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var r=e.parseJSON(d);if(r.error){wdtNotify("Error!",r.error,"danger");return}if(r.success){if(e(".jstree-node[id='"+r.data.folder_id+"'] > a.jstree-anchor .wpdt-folder-count").html(r.data.item_count),r.data.item_ids.length){for(let a=0;a<r.data.item_ids.length;a++)isNaN(n)||0!==n?e("#wpdt-the-list td.column-id").filter(function(){return parseInt(this.innerText)===r.data.item_ids[a]}).closest("tr").find(".column-folders").append('<span class="wpdt-folder-tag"><a class="wpdt-folder-tag-link wpdt-node-class-id-'+r.data.folder_id+'" href="admin.php?page='+r.data.item_page+"&folderID="+r.data.folder_id+'">'+r.data.folder_name+'</a><span class="wpdt-reassign-folder" data-folder-id="'+r.data.folder_id+'" data-'+r.data.type+'-id="'+r.data.item_ids[a]+'"></span></span>'):e("#wpdt-the-list td.column-id").filter(function(){return parseInt(this.innerText)===r.data.item_ids[a]}).closest("tr").remove();l.find(".wp-list-table input").click(),e("#wpdt-unassigned-folder_anchor .wpdt-count").html(r.data.unassigned),wdtNotify("Success!",r.data.type_caps+"s are assigned to the folder.","success")}else wdtNotify("Error!","Item ids are empty.","danger")}},error:function(e){wdtNotify("Error!","Unable to assign the item to a folder. Please try again.","danger")}})}else{var p=e(r.draggable).data("drag-"+t.type+"-id"),f=e(this).find(".wpdt-folder-count").html();e.ajax({url:ajaxurl,type:"POST",data:{item_id:p,item_count:parseInt(f),folder_name:s,folder_id:a,action:"wpdatatables_assign_item_in_folder",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var a=e.parseJSON(d);if(a.error){wdtNotify("Error!",a.error,"danger");return}if(a.success){e(".jstree-node[id='"+a.data.folder_id+"'] > a.jstree-anchor .wpdt-folder-count").html(a.data.item_count);let o=new URLSearchParams(window.location.search),n=parseInt(o.get("folderID"));isNaN(n)||0!==n?e(r.draggable).closest("tr").find(".column-folders").append('<span class="wpdt-folder-tag"><a class="wpdt-folder-tag-link wpdt-node-class-id-'+a.data.folder_id+'" href="admin.php?page='+a.data.item_page+"&folderID="+a.data.folder_id+'">'+s+'</a><span class="wpdt-reassign-folder" data-folder-id="'+a.data.folder_id+'" data-'+a.data.type+'-id="'+a.data.item_id+'"></span></span>'):e(r.draggable).closest("tr").remove(),e("#wpdt-unassigned-folder_anchor .wpdt-count").html(a.data.unassigned),wdtNotify("Success!",a.data.type+" is assigned to the folder.","success")}},error:function(e){wdtNotify("Error!","Unable to assign a folder. Please try again.","danger")}})}}}})},folderSearch(){let d=e.trim(e("#wpdt-folder-search").val());t.instance.jstree(!0).show_all(),t.instance.jstree("search",d),t.resetFoldersCount(),e(".wpdt-folders-sum li a, #wpdt-folder-tree li a").removeClass("jstree-clicked")},resetFoldersCount(){for(let t=0;t<wpdatatables_folders_data.folders.length;t++)e(".jstree-node[id='"+wpdatatables_folders_data.folders[t].id+"']").attr("parent",wpdatatables_folders_data.folders[t].parent),e(".jstree-node[id='"+wpdatatables_folders_data.folders[t].id+"'] > a.jstree-anchor .wpdt-folder-count").html(wpdatatables_folders_data.folders[t].item_count)},refreshFolders(e){var d=t.instance.jstree(!0);wpdatatables_folders_data.folders=e,d.settings.core.data=e,d.refresh()},isFolderNameUnique:function(e){let d=[];for(let r of(t.instance.jstree(!0).get_json("#",{flat:!0}).forEach(function(e){d.push(e.text)}),d))if(r===e)return!1;return!0},handleFoldersModal:function(d){let r=e("#wpdt-folder-modal"),a=e("#wpdt-save-folder-modal"),s=e("#wpdt-delete-folder-modal"),o=e("#wpdt-remove-folder-modal"),n=e("#wpdt-folder-name");if(n.val(""),r.attr("data-action",""),"wpdt-create-folder-btn"===d&&(r.attr("data-action","create"),r.find(".modal-title").html("Create Folder"),r.find(".wpdt-folder-delete-notice").addClass("hidden"),r.find(".wpdt-folder-remove-notice").addClass("hidden"),r.find("hr").addClass("hidden"),a.removeClass("hidden"),n.removeClass("hidden"),n.focus(),s.addClass("hidden"),o.addClass("hidden")),"wpdt-edit-folder-btn"===d){r.attr("data-action","edit");let l=t.instance.jstree("get_selected",!0)[0];l&&(t.selectedNodeId=l.id,n.val(l.text),r.find("hr").addClass("hidden"),a.removeClass("hidden"),n.removeClass("hidden"),n.focus(),s.addClass("hidden"),o.addClass("hidden"),r.find(".modal-title").html("Edit Folder"),r.find(".wpdt-folder-delete-notice").addClass("hidden"),r.find(".wpdt-folder-remove-notice").addClass("hidden"))}"wpdt-delete-folder-btn"===d&&(r.attr("data-action","delete"),a.addClass("hidden"),n.addClass("hidden"),s.removeClass("hidden"),o.addClass("hidden"),r.find("hr").removeClass("hidden"),r.find(".modal-title").html("Are you sure that you want to delete selected folder?"),r.find(".wpdt-folder-delete-notice").removeClass("hidden"),r.find(".wpdt-folder-remove-notice").addClass("hidden")),"wpdt-remove-folder-tag"===d&&(r.attr("data-action","remove"),a.addClass("hidden"),n.addClass("hidden"),s.addClass("hidden"),o.removeClass("hidden"),r.find("hr").removeClass("hidden"),r.find(".modal-title").html("Are you sure that you want to remove "+t.type+" from this folder?"),r.find(".wpdt-folder-delete-notice").addClass("hidden"),r.find(".wpdt-folder-remove-notice").removeClass("hidden")),r.modal("show")},handleSaveFolder:function(){let d=e("#wpdt-folder-name").val().trim(),r=e("#wpdt-folder-modal").attr("data-action"),a=t.instance.jstree("get_selected",!0)[0],s=-1;if("create"===r){if(!d)return e("#wpdt-folder-empty-error").removeClass("hidden"),!1;if(void 0!==a&&(s=a.id),!t.isFolderNameUnique(d))return e("#wpdt-folder-unique-error").removeClass("hidden"),!1;e("#wpdt-new-folder-name").val(""),e("#wpdt-folder-unique-error, #wpdt-folder-empty-error").addClass("hidden"),e.ajax({url:ajaxurl,type:"POST",data:{parent_id:s,folder_id:-1,folder_action:"insert",action:"wpdatatables_folder_actions",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type,name:d},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var r=e.parseJSON(d);if(r.error){wdtNotify("Error!",r.error,"danger");return}if(r.success){if(r.data.length){let a=r.lastInsertID?r.lastInsertID:r.data.length-1;var s=r.data.filter(e=>e.id==a),o=s[0].text,n="#"==s[0].parent;o=o.replace(/\\/g,""),wpdatatables_folders_data.folders=r.data,t.instance.jstree("create_node",s[0].parent,{id:s[0].id,text:o,state:{opened:!n}},a,function(){e(".jstree-node[id='"+s[0].id+"'] > a.jstree-anchor .wpdt-folder-count").text(0);let d=t.instance.jstree("get_selected",!0)[0],r=t.instance.jstree(!0);if(d){let a=r.get_node(s[0].parent);r.open_node(a)}}),n&&t.refreshFolders(r.data),t.resetFoldersCount(),t.instance.find(".jstree-node#"+s[0].id+" .wpdt-folder-count").html(0),e(".jstree-node[id='"+s[0].id+"']").length&&e(".jstree-node[id='"+s[0].id+"'] > a.jstree-anchor").trigger("focus"),e("#wpdt-folder-modal").modal("hide"),wdtNotify("Success: ","Folder is created.","success")}else wdtNotify("Error!","Data is empty. Please try again.","danger")}else wdtNotify("Error!","Unable to create folder. Please try again.","danger");t.instance.removeClass("hidden")},error:function(e){wdtNotify("Error!","Unable to create folder. Please try again.","danger")}})}if("edit"===r){if(!d||!t.selectedNodeId)return e("#wpdt-folder-empty-error").removeClass("hidden"),!1;if(!t.isFolderNameUnique(d))return e("#wpdt-folder-unique-error").removeClass("hidden"),!1;void 0!==a&&a.parent&&"#"!=a.parent&&(s=a.parent),e.ajax({url:ajaxurl,type:"POST",data:{parent_id:s,folder_id:t.selectedNodeId,folder_action:"update",action:"wpdatatables_folder_actions",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type,name:d},success:function(r){if(!t.isJsonString(r)){wdtNotify("Error!",r,"danger");return}var a=e.parseJSON(r);if(a.error){wdtNotify("Error!",a.error,"danger");return}a.success?(t.instance.jstree("rename_node",t.selectedNodeId,d),wpdatatables_folders_data.folders=wpdatatables_folders_data.folders.map(e=>e.id==t.selectedNodeId?{...e,text:d}:e),e("a.wpdt-node-class-id-"+t.selectedNodeId).html(d),e("#wpdt-folder-modal").modal("hide"),wdtNotify("Success: ","Folder is edited.","success")):wdtNotify("Error!","Unable to edit a folder. Please try again.","danger")},error:function(e){wdtNotify("Error!","Unable to edit a folder. Please try again.","danger")}})}},handleDeleteFolder:function(){let d=t.instance.jstree("get_selected",!0)[0];var r=new URLSearchParams(window.location.search),a=d.children_d,s=d.id,o=parseInt(r.get("folderID"));d&&e.ajax({url:ajaxurl,type:"POST",data:{parent_id:d.parent,children_ids:a,folder_id:s,folder_action:"delete",action:"wpdatatables_folder_actions",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type,name:d.text},success:function(r){if(!t.isJsonString(r)){wdtNotify("Error!",r,"danger");return}var n=e.parseJSON(r);if(n.error){wdtNotify("Error!",n.error,"danger");return}if(n.success){if(t.instance.jstree("delete_node",d),s){let l=e("a.wpdt-node-class-id-"+d.id).closest("td");for(let i of(e("a.wpdt-node-class-id-"+d.id).closest(".wpdt-folder-tag").remove(),l))e(i).find("a").length||isNaN(o)||0===o||-1===o||e(i).closest("tr").remove()}if(a)for(let c of a){let p=e("a.wpdt-node-class-id-"+c).closest("td");for(let f of(e("a.wpdt-node-class-id-"+c).closest(".wpdt-folder-tag").remove(),p))e(f).find("a").length||isNaN(o)||0===o||-1===o||e(tempTD).closest("tr").remove()}t.handleSelectNode(),t.resetFoldersCount(),e("#wpdt-unassigned-folder_anchor .wpdt-count").html(n.data),wdtNotify("Success: ","Folder is deleted.","success")}else wdtNotify("Error!","Unable to delete a folder. Please try again.","danger")},error:function(e){wdtNotify("Error!","Unable to delete a folder. Please try again.","danger")}})},handleRemoveFolderTag:function(d,r,a){var s=new URLSearchParams(window.location.search),o=parseInt(s.get("folderID"));d&&e.ajax({url:ajaxurl,type:"POST",data:{item_id:r,folder_id:d,folder_action:"remove",action:"wpdatatables_remove_folder_tag",wdtNonce:e("#wdtFoldersNonce").val(),type:t.type},success:function(d){if(!t.isJsonString(d)){wdtNotify("Error!",d,"danger");return}var r=e.parseJSON(d);if(r.error){wdtNotify("Error!",r.error,"danger");return}r.success?(isNaN(o)||o!==parseInt(r.data.folder_id)||a.closest("tr").remove(),a.closest(".wpdt-folder-tag").remove(),wpdatatables_folders_data.folders=wpdatatables_folders_data.folders.map(e=>e.id==r.data.folder_id?{...e,item_count:r.data.item_count}:e),t.resetFoldersCount(),e(".jstree-node[id='"+r.data.folder_id+"'] > a.jstree-anchor .wpdt-folder-count").html(r.data.item_count),e("#wpdt-unassigned-folder_anchor .wpdt-count").html(r.data.unassigned),wdtNotify("Success: ",r.data.type_caps+" is removed from folder.","success"),e("#wpdt-folder-modal").modal("hide")):wdtNotify("Error!","Unable to remove the item from a folder. Please try again.","danger")},error:function(e){wdtNotify("Error!","Unable to remove the item from a folder. Please try again.","danger")}})},handleSelectNode:function(){let d=t.instance.jstree("get_selected",!0)[0];d?(e("#wpdt-edit-folder-btn").removeClass("disabled"),e("#wpdt-delete-folder-btn").removeClass("disabled")):(e("#wpdt-edit-folder-btn").addClass("disabled"),e("#wpdt-delete-folder-btn").addClass("disabled")),e(".wpdt-folders-sum li a").removeClass("jstree-clicked")},isJsonString:function(e){try{JSON.parse(e)}catch(t){return!1}return!0}};e(document).ready(function(){t.init()})})}(jQuery);