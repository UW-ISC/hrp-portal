{"version":3,"file":"gp-nested-forms-admin.js","mappings":"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","sources":["webpack:///./js/src/admin.js"],"sourcesContent":["\n( function( GPNFAdmin, $ ) {\n\n\tGPNFAdmin = function() {\n\n\t\tvar self = this;\n\n\t\tself.init = function() {\n\n\t\t\tself.$formSelect         = $( '#gpnf-form' );\n\t\t\tself.$fieldSelect        = $( '#gpnf-fields' );\n\t\t\tself.$formSettings       = $( '#gpnf-form-settings' );\n\t\t\tself.$entryLabelSingular = $( '#gpnf-entry-label-singular' );\n\t\t\tself.$entryLabelPlural   = $( '#gpnf-entry-label-plural' );\n\t\t\tself.$entryLimitMin      = $( '#gpnf-entry-limit-min' );\n\t\t\tself.$entryLimitMax      = $( '#gpnf-entry-limit-max' );\n\t\t\tself.$feedProcessing     = $( '#gpnf-feed-processing' );\n\t\t\tself.$modalHeaderColor   = $( '#gpnf-modal-header-color' );\n\t\t\tself.$editChildForm      = $( '#gpnf-edit-child-form' );\n\n\t\t\t$( document ).bind( 'gform_load_field_settings', function( event, field, form ) {\n\n\t\t\t\tif( field.type != 'form' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar nestedFormId = field['gpnfForm'];\n\n\t\t\t\tself.$entryLabelSingular.val( field['gpnfEntryLabelSingular'] );\n\t\t\t\tself.$entryLabelPlural.val( field['gpnfEntryLabelPlural'] );\n\t\t\t\tself.$entryLimitMin.val( field['gpnfEntryLimitMin'] );\n\t\t\t\tself.$entryLimitMax.val( field['gpnfEntryLimitMax'] );\n\t\t\t\tself.$feedProcessing.val( self.getFeedProcessingSetting( field ) );\n\n\t\t\t\tself.$modalHeaderColor.val( field['gpnfModalHeaderColor'] );\n\t\t\t\t$( '#chip_gpnf-modal-header-color' ).css( 'background-color', field['gpnfModalHeaderColor'] );\n\n\t\t\t\t// set the 'form' field even if there is no value (resets 'form' for fields with no form selected)\n\t\t\t\tself.$formSelect.val( nestedFormId );\n\t\t\t\tself.setEditChildFormLink( nestedFormId );\n\n\t\t\t\tvar selectedFields = field['gpnfFields'] ? field['gpnfFields'] : [];\n\t\t\t\tself.toggleNestedFormFields( selectedFields );\n\n\t\t\t} );\n\n\t\t\t// Initialize color picker.\n\t\t\t$( \"#chooser_gpnf-modal-header-color, #chip_gpnf-modal-header-color\" ).click( function( event ) {\n\t\t\t\tiColorShow( event.pageX - 245, event.pageY - 57, 'gpnf-modal-header-color', 'gpnfSetModalHeaderColor' );\n\t\t\t} );\n\n\t\t\t$().add( self.$entryLabelSingular ).add( self.$entryLabelPlural ).on( 'change', function() {\n\t\t\t\tRefreshSelectedFieldPreview();\n\t\t\t} );\n\n\t\t};\n\n\t\tself.toggleNestedFormFields = function( selectedFields ) {\n\t\t\tself.$fieldSelect\n\t\t\t\t.attr( 'disabled', true );\n\t\t\tif ( self.$formSelect.val() ) {\n\t\t\t\tself.$formSettings.show();\n\t\t\t\tself.getFormFields( self.$formSelect.val(), selectedFields ? selectedFields : [] );\n\t\t\t} else {\n\t\t\t\tself.$formSettings.hide();\n\t\t\t}\n\t\t};\n\n\t\tself.setEditChildFormLink = function( childFormId ) {\n\t\t\tself.$editChildForm.attr( 'href', '?page=gf_edit_forms&id=' + childFormId );\n\t\t}\n\n\t\tself.sortAsmSelectDropdown = function( fields ) {\n\t\t\tvar $select = self.$fieldSelect.siblings('.asmSelect');\n\t\t\tvar fieldIds = fields.map(function(field) {\n\t\t\t\treturn field.id.toString();\n\t\t\t});\n\n\t\t\t$select.find('option:not([value=\"\"])').sort(function(a, b) {\n\t\t\t\ta = fieldIds.indexOf(a.value.toString());\n\t\t\t\tb = fieldIds.indexOf(b.value.toString());\n\n\t\t\t\treturn a - b;\n\t\t\t}).appendTo($select);\n\t\t}\n\n\t\tself.setFieldsSelect = function( fields, selectedFields ) {\n\n\t\t\tvar options = [];\n\n\t\t\tif ( ! fields.length && selectedFields.length ) {\n\t\t\t\tfor ( var i = 0; i < selectedFields.length; i++ ) {\n\t\t\t\t\toptions.push( '<option value=\"' + selectedFields[ i ] + '\" selected=\"selected\">' + selectedFields[i] + '</option>' );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Sort the fields/options to match the value. Without doing this, the order of the sortable will be\n\t\t\t\t// incorrect.\n\t\t\t\t//\n\t\t\t\t// This also means we need to re-sort the \"Select your fields\" dropdown to match the field order from\n\t\t\t\t// the child form.\n\t\t\t\tvar sortedFields = $.extend([], fields).sort(function(a, b) {\n\t\t\t\t\ta = selectedFields.indexOf(a.id.toString());\n\t\t\t\t\tb = selectedFields.indexOf(b.id.toString());\n\n\t\t\t\t\treturn a - b;\n\t\t\t\t});\n\n\t\t\t\tfor ( var i = 0; i < sortedFields.length; i++ ) {\n\t\t\t\t\tvar field = sortedFields[i];\n\t\t\t\t\t// Interestingly, setting the .val() on the select does not work so we need to fallback to setting\n\t\t\t\t\t// the selected attribute on the options.\n\t\t\t\t\tvar selected = $.inArray( String( field.id ), selectedFields ) != -1 ? 'selected=\"selected\"' : '';\n\n\t\t\t\t\tif ( $.inArray( field.type, [ 'page', 'html', 'section', 'captcha' ] ) === -1 ) {\n\t\t\t\t\t\toptions.push( '<option value=\"' + field.id + '\"' + selected + '>' +  GetLabel( field ) + '</option>' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.$fieldSelect\n\t\t\tself.$fieldSelect\n\t\t\t\t.html( options.join( '' ) )\n\t\t\t\t.val( selectedFields )\n\t\t\t\t.change();\n\n\t\t\tif ( self.$fieldSelect.data( 'asmApplied' ) ) {\n\t\t\t\tself.sortAsmSelectDropdown( fields );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar updateFields = function(val) {\n\t\t\t\tSetFieldProperty( 'gpnfFields', val );\n\t\t\t\tRefreshSelectedFieldPreview();\n\t\t\t};\n\n\t\t\tself.$fieldSelect.asmSelect({\n\t\t\t\taddItemTarget: 'bottom',\n\t\t\t\thighlight: true,\n\t\t\t\tsortable: true\n\t\t\t}).data( 'asmApplied', true );\n\n\t\t\tvar $sortable = self.$fieldSelect.siblings('.asmListSortable');\n\n\t\t\t// Change axis to undefined to allow dragging on x and y axes\n\t\t\t$sortable.sortable('option', 'axis', '');\n\n\t\t\t// Do not allow scrolling as there is no way to only disable X-axis scrolling\n\t\t\t$sortable.sortable('option', 'scroll', false);\n\n\t\t\t// Force getting offset parent position and caching it. Without this, if the field settings are scrolled\n\t\t\t// and dragging starts, the ghost will be positioned incorrectly until another item is intersected.\n\t\t\t$sortable.on('sortstart', function() {\n\t\t\t\tvar sortable = $(this).sortable('instance');\n\t\t\t\tsortable.offset.parent = sortable._getParentOffset();\n\t\t\t});\n\n\t\t\t// Bind directly to sortupdate on the sortable as ASM select doesn't seem to be passing the value on\n\t\t\t// correctly.\n\t\t\t$sortable.on('sortupdate', function () {\n\t\t\t\t// Use setTimeout to give ASM select time to update the field value (but ironically not trigger a change)\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tupdateFields(self.$fieldSelect.val());\n\t\t\t\t}, 5);\n\t\t\t})\n\n\t\t\tself.$fieldSelect.change(function () {\n\t\t\t\tupdateFields($(this).val());\n\t\t\t});\n\n\t\t\tself.sortAsmSelectDropdown( fields );\n\t\t};\n\n\t\tself.getFormFields = function( formId, selectedFields ) {\n\t\t\t$.post( ajaxurl, {\n\t\t\t\taction: 'gpnf_get_form_fields',\n\t\t\t\tnonce: GPNFAdminData.nonces.getFormFields,\n\t\t\t\tform_id: formId\n\t\t\t}, function( fields ) {\n\t\t\t\tself.$formSettings.find( 'select' ).attr( 'disabled', false );\n\t\t\t\tif( typeof fields === 'object' ) {\n\t\t\t\t\tself.setFieldsSelect( fields, selectedFields );\n\t\t\t\t} else {\n\t\t\t\t\talert( GPNFAdminData.strings.getFormFieldsError );\n\t\t\t\t}\n\t\t\t\t} );\n\t\t};\n\n\t\tself.getFeedProcessingSetting = function( field ) {\n\t\t\treturn field.gpnfFeedProcessing ? field.gpnfFeedProcessing : 'parent';\n\t\t};\n\n\t\tself.init();\n\n\t};\n\n\twindow.gpnfSetModalHeaderColor = function( color ) {\n\t\tSetFieldProperty( 'gpnfModalHeaderColor', color );\n\t};\n\n\t$( document ).ready( function() {\n\t\tif( ! window.gpGlobals ) {\n\t\t\twindow.gpGlobals = {};\n\t\t}\n\t\twindow.gpGlobals.GPNFAdmin = new GPNFAdmin();\n\t} );\n\n} )( window.GPNFAdmin = window.GPNFAdmin || {}, jQuery );\n"],"names":["GPNFAdmin","$","window","jQuery","self","this","init","$formSelect","$fieldSelect","$formSettings","$entryLabelSingular","$entryLabelPlural","$entryLimitMin","$entryLimitMax","$feedProcessing","$modalHeaderColor","$editChildForm","document","bind","event","field","form","type","nestedFormId","val","getFeedProcessingSetting","css","setEditChildFormLink","selectedFields","toggleNestedFormFields","click","iColorShow","pageX","pageY","add","on","RefreshSelectedFieldPreview","attr","show","getFormFields","hide","childFormId","sortAsmSelectDropdown","fields","$select","siblings","fieldIds","map","id","toString","find","sort","a","b","indexOf","value","appendTo","setFieldsSelect","options","length","i","push","sortedFields","extend","selected","inArray","String","GetLabel","html","join","change","data","updateFields","SetFieldProperty","asmSelect","addItemTarget","highlight","sortable","$sortable","offset","parent","_getParentOffset","setTimeout","formId","post","ajaxurl","action","nonce","GPNFAdminData","nonces","form_id","alert","strings","getFormFieldsError","gpnfFeedProcessing","gpnfSetModalHeaderColor","color","ready","gpGlobals"],"sourceRoot":""}