"use strict";(self.webpackJSONPwpmdb=self.webpackJSONPwpmdb||[]).push([[879],{78879:(e,r,a)=>{a.r(r),a.d(r,{importFile:()=>c,setImportTableData:()=>_,uploadFileActions:()=>d});var t=a(4516),i=a(67821),m=a(66055),s=a(29950),n=a(38906),o=a(29942),p=a(66866),l=a(26547),_=e=>(r,a)=>r((0,m.m)(l.VG,e)),c=e=>async(r,a)=>{var l,u=(0,t.FY)("import_gzipped",a()),f=(0,i.selectFromImportData)("file_size",a()),d={chunk:e.chunk,current_query:e.current_query,import_file:e.import_filename};d.import_info=JSON.stringify({import_gzipped:u});try{l=await(0,o.op)("/import-file",d)}catch(b){return r((0,n.m7)({error_type:p.gF,error_message:b.message})),!1}var g=l.data,y=g.table_sizes,w=g.table_rows,h=g.tables;r(_({table_sizes:y,table_rows:w,tables:h}));var v=Math.ceil(f/g.num_chunks)/1e3;if(r((0,n.gF)(v)),g.chunk>=g.num_chunks)return r((0,n.v_)()),r((0,m.m)(s.sP,"import")),r((0,n.Z6)("MIGRATE",[],"find_replace"));var F=[{import_filename:e.import_filename,item_name:e.item_name,chunk:g.chunk,current_query:g.current_query}];return await r((0,n.Z6)("IMPORT_FILE",[{fn:c,args:F}]))},u=1024e3,f=e=>async(r,a)=>{var t;r((0,m.m)(s.f7,"import")),r((0,m.m)(p.Lw));try{t=await(0,o.op)("/prepare-upload",{})}catch(u){return r((0,n.m7)({error_type:p.gF,error_message:u.message})),!1}var i=e.name,l=window.wpmdb_strings.importing_file_to_db.replace(/%s\s?/,i);r((0,m.m)(p.V$,l)),".gz"===i.slice(-3)&&(i=e.name.slice(0,-3));var _=[{import_filename:t.data.import_file,item_name:i,chunk:0,current_query:""}];return await r((0,n.Z6)(n.p_,[{fn:c,args:_}]))},d=e=>async(r,a)=>{var l=(0,t.NR)("remote_site",a());e="undefined"===typeof e?0:e;var _=(0,i.selectFromImportData)("file",a()),c=e+u+1,g=new FileReader;0===e&&(r((0,m.m)(s.f7,"upload")),r((0,n.Wv)(Math.ceil((0,i.selectFromImportData)("file_size",a())/1e3)))),g.onloadend=async function(a){if(a.target.readyState===FileReader.DONE){var t={action:"wpmdb_upload_file",file_data:a.target.result,file:_.name,file_type:_.type,stage:"import",import_info:l};try{await(0,o.op)("/upload-file",t)}catch(u){return r((0,n.m7)({error_type:p.gF,error_message:u.message})),!1}if(c<_.size)return r((0,n.gF)(Math.ceil(1024))),await r((0,n.Z6)(n.uk,[{fn:d,args:[c]}]));var i=_.size-e;return r((0,n.gF)(Math.ceil(i/1e3))),r((0,m.m)(s.sP,"upload")),await r((0,n.Z6)(n.h8,[{fn:f,args:[_]}]))}};var y=_.slice(e,c);g.readAsDataURL(y)}}}]);